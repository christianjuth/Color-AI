<html>
	<head>
		<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
		<script type="text/javascript" src="./brain.min.js"></script>
		<link href="https://fonts.googleapis.com/css?family=Staatliches" rel="stylesheet">

		<title>Color AI</title>

		<style type="text/css">
			body{
				background: #000;
			}

			input{
				display: none;
			}

			p{
				position: absolute;
				margin: 0;
				font-family: arial;
			    color: #fff;
			}

			#color{
			    height: 100%;
			    width: 100%;
			    top: 0;
			    left: 0;
			    font-size: 10vw;
			    text-align: center;
			    line-height: 96vh;
			    font-family: Staatliches;
			    text-shadow: 3px 3px rgba(0, 0, 0, 0.14);
			}

			#value{
				position: absolute;
			    bottom: 10px;
			    right: 10px;
			    opacity: 0.7;
			    font-family: monospace;
			    font-size: 18px;
			}
		</style>

		<script type="text/javascript">
			const network = new brain.NeuralNetwork();
			$.getJSON("./model/colorName.json", function(json) {
			    network.fromJSON(json);
			});

			const darkLight = new brain.NeuralNetwork();
			$.getJSON("./model/darkLight.json", function(json) {
			    darkLight.fromJSON(json);
			});

			function hexToRgb(hex) {
			    var result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
			    return result ? [
			        parseInt(result[1], 16)/255,
			        parseInt(result[2], 16)/255,
			        parseInt(result[3], 16)/255
			    ] : null;
			}


			$(document).ready(() => {
				// foward click
				$("p").click(() => $("input").click());

				// on select color
				$("input").change(function() {
					let value = $(this).val();

					$("body").css({background: value});
					$("#value").text(value);
					value = hexToRgb(value);

					let isLight = darkLight.run(value);
					if(isLight > 0.5){
						$("p").css({color: '#fff'});
					} else{
						$("p").css({color: '#000'});
					}

					let out = network.run(value);
					colors = Object.keys(out).sort((a, b) => out[a] > out[b] ? -1 : 1);
					$("#color").text(colors[0]);
				});
			});
		</script>
	</head>
	<body>
		<p id="color">black</p>
		<p id="value">#000000</p>
		<input type="color" name="favcolor" value="#000">
	</body>
</html>